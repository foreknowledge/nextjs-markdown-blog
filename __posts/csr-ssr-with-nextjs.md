---
title: CSR / SSR with Next.js
date: '2023-07-03'
description: Next.js로 알아보는 CSR과 SSR.
category:
tags:
  - CSR
  - SSR
  - Next.js
---

## CSR과 그의 장단점은 무엇인가?

CSR(Client Side Rendering)이란, 웹 애플리케이션 렌더링 기법 중 하나로 **서버에서 전달 받은 데이터를 클라이언트(웹 브라우저)에서 처리해 동적으로 페이지를 그리는 방식**을 뜻한다.
서버로부터 body가 비어있는 html 페이지와 스크립트 파일을 받아온 뒤, 브라우저에서 스크립트를 실행해 동적으로 DOM 요소를 만들어 화면을 보여주는 방식으로 동작한다.

**그렇다면 왜 CSR 방식이 등장했을까?** CSR과 대립되는 개념은 SSR(= Server Side Rendering)인데, CSR 방식이 등장하기 전에는 SSR 방식으로 웹 페이지를 그렸다. 서버에서 완전한 HTML을 생성해서 웹 브라우저로 전송하면, 브라우저에서는 완전한 HTML을 보여주는 식으로 웹이 동작했었다.
이 시기의 SSR의 문제는 브라우저에서는 화면 요소를 변경하기 위해서는 서버와 통신이 필수적이었고, 서버와 통신한 뒤 화면을 다시 그리는 동안 사용자는 꼼짝 않고 기다려야 했다는 것이다. 이는 사용자에게 좋지 않은 UX로 다가왔고, 이를 해결하기 위해 CSR이 등장했다.

CSR은 화면을 브라우저에서 그리기 때문에 **사용자 인터랙션에 있어 반응이 빠르다**는 장점이 있다. 예를 들어, 어떤 버튼을 눌렀을 때 추가적인 화면을 그려야 하는 웹 페이지가 있다고 하자. SSR 방식은 버튼을 눌렀을 때 서버에게 새로운 페이지를 요청하고 변경사항을 반영하는 방식으로 느리게 반응한다면, CSR 방식은 버튼을 눌렀을 때 DOM을 직접 조작해 서버와 통신하지 않고도 바로 적절한 화면을 보여줄 수 있다. 이로써 사용자는 웹 페이지가 '즉각적으로 반응한다' 라고 느낄 수 있는 것이다.

하지만 CSR 방식은 사용자와의 상호작용을 위해 희생당한 부분도 있다. 화면 렌더링과 data fetching을 클라이언트로 전환하면서 보안 이슈도 생기고, 한 페이지와 연관된 리소스가 증가하면서 번들 사이즈가 커져 초기 로드 시간이 증가한다는 점, 브라우저 캐싱이나 SEO(Search Engine Optimization) 문제도 있다.

## SPA로 구성된 앱에서 SSR이 필요한 이유?

SPA(= Single Page Application)란 **전체 애플리케이션을 단일 페이지로 구성하는 방식**을 이야기한다. SPA는 초기 로딩 이후에는 서버로부터 페이지 전체를 다시 로드하지 않고, 동적으로 필요한 부분만 업데이트하여 사용자와 상호작용하기 때문에 빠른 상호작용을 통해 UX를 극적으로 끌어올릴 수 있다는 장점이 있다. SPA로 만든 웹 페이지는 사용자에게 마치 모바일 앱을 다루는 것과 같은 느낌을 줄 수도 있다.

하지만 SPA는 위의 CSR의 단점을 그대로 가지고 있다.

1. **보안 문제**
   : access token이나 api key 값과 같이 보안에 민감한 정보를 클라이언트가 가지고 있음으로써 보안 이슈를 신경써야 한다.
2. **초기 로드 시간 증가**
   : SPA이기 때문에 첫 페이지에 접근할 때 서버로부터 전체 애플리케이션 코드를 받아와야 한다. 이는 자바스크립트 번들 사이즈와 연관이 있는데, 첫 페이지 진입 시 큰 자바스크립트 번들을 로드하는 데 시간이 오래 걸려 사용자가 첫 페이지를 보는 데에 오래 기다리게 된다. 이는 앱이 클수록 큰 문제가 된다.
3. **브라우저 캐싱**
   : MPA(= Multi Page Application)일 때는 같은 요청에 대한 서버 응답을 브라우저가 캐싱하기 때문에 캐싱을 효율적으로 이용할 수 있었지만, 첫 페이지에 모든 것을 받아온 이후에는 페이지 요청을 하지 않는 SPA 방식에서는 무용지물이 되었다.
4. **SEO**
   : 마찬가지로 url에 해당하는 페이지를 가져올 때 검색 엔진은 빈 페이지를 받기 때문에 내용을 알 수 없어서 검색 결과에 감지되지 않는다.

이런 이유로 이제는 SSR과 CSR을 같이 사용하는 하이브리드 방식이 등장하고 있다. 대표적인 예가 Next.js의 SSR, SSG(= Static Site Generation) 같이 페이지를 pre-rendering 하는 방식이다.

Next.js는 SSR, SSG 방식을 이용해 내용이 채워진 HTML을 전달하게 할 수 있다. 물론 CSR 방식을 유지할 수도 있는데 이는 그리려고 하는 화면의 특징에 따라 나뉜다. 사용자 인터랙션을 통해 페이지가 렌더링 되어야 한다면 (ex. 검색 페이지) CSR이 적합한 선택일 것이고, 인터랙션에 따라 변경되지 않는 정적인 화면이라면 (ex. 블로그 포스팅) SSR이나 SSG를 사용할 수 있겠다.

Next.js의 SSR을 사용해 미리 렌더링된 페이지를 받아옴으로써 위의 문제를 어느정도 해결할 수 있다.

1. 보안 문제
   : 보안이 예민한 데이터는 서버에서 관리한다. 예를 들어, API_KEY를 서버에서 관리하고 클라이언트에서는 서버로 API 요청만 하는 것이다.
2. 초기 로드 시간
   : Next.js에서는 code splitting이라는 기법을 사용해서 페이지 단위로 파일을 번들링한다. 해당 페이지에 필요한 파일만 받아오기 때문에 초기 로드 시간이 감소한다.
3. 브라우저 캐싱
   : 이제 페이지 별로 서버에 요청을 하기 때문에 요청에 대한 응답을 캐싱하는 브라우저 캐싱의 덕을 볼 수 있다.
4. SEO
   : SSR을 사용하는 페이지는 내용이 채워진 HTML이 전달되기 때문에 검색 엔진이 내용을 보고 검색 결과에 포함시킬지 제대로 판별할 수 있다.

기존에 CSR만으로 SPA를 구성하는 방식의 문제를 SSR을 도입함으로써 해결할 수 있게 되었다.
